# 合图拆图工具开发计划

## 项目概述
使用 Vue3 + TypeScript 开发一个合图拆图工具，支持将多个图片合并成一张合图，以及从合图中拆分出原始图片。

## 功能需求

### 核心功能
1. **合图功能（Sprite Sheet Packing）**
   - 支持拖拽或选择多个图片文件
   - 自动排列图片到合图中
   - 支持多种排列算法（简单排列、最佳适配等）
   - 生成合图文件（PNG/JPG）
   - 导出配置文件（JSON/XML），记录每个子图的位置和尺寸

2. **拆图功能（Sprite Sheet Unpacking）**
   - 上传合图文件
   - 上传或手动输入配置文件（JSON/XML）
   - 根据配置自动拆分出所有子图
   - 支持批量下载拆分后的图片

3. **辅助功能**
   - 图片预览
   - 合图预览（显示网格线、子图边界）
   - 配置编辑（手动调整位置、尺寸）
   - 导出格式选择（PNG、JPG、WebP等）

## 技术栈

### 前端框架
- **Vue 3** - 使用 Composition API
- **TypeScript** - 类型安全
- **Vite** - 快速构建工具

### UI 框架
- **Element Plus** 或 **Ant Design Vue** - UI组件库
- **VueUse** - 组合式工具库

### 图片处理
- **Canvas API** - 图片绘制和处理
- **File API** - 文件读取和处理

### 工具库
- **pinia** - 状态管理
- **vue-router** - 路由管理（如需要多页面）

## 项目结构

```
spritesheettool/
├── public/                 # 静态资源
├── src/
│   ├── assets/            # 资源文件
│   ├── components/        # 组件
│   │   ├── ImageUploader.vue      # 图片上传组件
│   │   ├── SpritePreview.vue      # 合图预览组件
│   │   ├── ConfigEditor.vue       # 配置编辑组件
│   │   └── ImageList.vue          # 图片列表组件
│   ├── composables/       # 组合式函数
│   │   ├── useImageProcessor.ts   # 图片处理逻辑
│   │   ├── useSpritePacker.ts     # 合图算法
│   │   └── useSpriteUnpacker.ts   # 拆图逻辑
│   ├── utils/             # 工具函数
│   │   ├── imageUtils.ts          # 图片工具函数
│   │   ├── fileUtils.ts           # 文件工具函数
│   │   └── configParser.ts        # 配置解析器
│   ├── types/             # 类型定义
│   │   ├── sprite.ts              # 合图相关类型
│   │   └── image.ts               # 图片相关类型
│   ├── stores/            # 状态管理
│   │   ├── spriteStore.ts         # 合图状态
│   │   └── imageStore.ts          # 图片状态
│   ├── App.vue            # 根组件
│   └── main.ts            # 入口文件
├── package.json
├── tsconfig.json
├── vite.config.ts
└── README.md
```

## 开发步骤

### 第一阶段：项目初始化（1-2天）
1. ✅ 使用 Vite 创建 Vue3 + TypeScript 项目
2. ✅ 安装必要的依赖（Element Plus、Pinia等）
3. ✅ 配置 TypeScript 和 ESLint
4. ✅ 搭建基础项目结构
5. ✅ 创建基础布局组件

### 第二阶段：核心功能开发 - 合图功能（3-5天）
1. **图片上传模块**
   - 实现拖拽上传
   - 支持多文件选择
   - 图片预览功能
   - 图片信息显示（尺寸、大小等）

2. **合图算法实现**
   - 实现简单的网格排列算法
   - 实现最佳适配算法（可选）
   - 计算合图尺寸
   - 生成子图位置信息

3. **合图生成**
   - 使用 Canvas 绘制合图
   - 导出合图文件
   - 生成配置文件（JSON格式）

4. **合图预览**
   - Canvas 预览合图
   - 显示网格线和子图边界
   - 支持缩放和拖拽查看

### 第三阶段：核心功能开发 - 拆图功能（2-3天）
1. **合图上传**
   - 上传合图文件
   - 上传配置文件
   - 解析配置文件

2. **拆图实现**
   - 根据配置从合图中提取子图
   - 使用 Canvas 裁剪图片
   - 生成独立的图片文件

3. **批量下载**
   - 实现 ZIP 打包功能（使用 JSZip）
   - 批量下载拆分后的图片

### 第四阶段：功能完善（2-3天）
1. **配置编辑**
   - 可视化编辑子图位置
   - 手动调整尺寸
   - 实时预览

2. **导出选项**
   - 支持多种图片格式
   - 质量设置
   - 文件命名规则

3. **用户体验优化**
   - 加载状态提示
   - 错误处理
   - 操作提示和帮助

### 第五阶段：测试和优化（1-2天）
1. 功能测试
2. 性能优化
3. 代码重构
4. 文档编写

## 技术难点

1. **合图算法**
   - 需要实现高效的图片排列算法
   - 考虑图片尺寸差异和空间利用率

2. **大图片处理**
   - 处理大尺寸图片时的内存管理
   - 使用 Web Worker 处理耗时操作

3. **Canvas 操作**
   - 图片绘制和裁剪
   - 坐标计算和转换

4. **文件处理**
   - 大文件上传和下载
   - 批量文件处理

## 依赖包清单

```json
{
  "dependencies": {
    "vue": "^3.4.0",
    "vue-router": "^4.2.0",
    "pinia": "^2.1.0",
    "element-plus": "^2.4.0",
    "@element-plus/icons-vue": "^2.3.0",
    "jszip": "^3.10.0",
    "@vueuse/core": "^10.7.0"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^5.0.0",
    "typescript": "^5.3.0",
    "vite": "^5.0.0",
    "@types/node": "^20.10.0"
  }
}
```

## 界面设计建议

### 主界面布局
- 左侧：功能选择（合图/拆图）
- 中间：主要操作区域
  - 合图模式：图片列表 + 合图预览
  - 拆图模式：合图上传 + 配置上传 + 拆分结果
- 右侧：配置和导出选项

### 关键交互
- 拖拽上传图片
- 实时预览合图效果
- 一键导出合图和配置
- 批量下载拆分图片

## 后续扩展功能（可选）

1. 支持动画序列合图
2. 支持 9 宫格切图
3. 支持图片压缩优化
4. 支持在线编辑图片（裁剪、旋转等）
5. 历史记录功能
6. 云端存储（可选）

## 时间估算

- 总计：约 10-15 个工作日
- 第一阶段：1-2天
- 第二阶段：3-5天
- 第三阶段：2-3天
- 第四阶段：2-3天
- 第五阶段：1-2天

